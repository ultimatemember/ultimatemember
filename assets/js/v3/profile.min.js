wp.hooks.addFilter("um_uploader_data","ultimate-member",function(e,a,t){var i;return"field-image"!==a&&"field-file"!==a||(e.filters.prevent_duplicates=!1,(i=t.parents("form").find('input[name="user_id"]')).length&&(i=i.val())&&(e.url+="&user_id="+i),(i=t.parents("form").find('input[name="form_id"]')).length&&(i=i.val())&&(e.url+="&form_id="+i),(i=t.parents(".um-field").data("key"))&&(e.url+="&field_id="+i),"field-image"===a&&(e.url+="&crop="+t.parents(".um-uploader").data("crop"))),e}),wp.hooks.addFilter("um_uploader_file_filtered","ultimate-member",function(a,t,i,r){if("field-image"!==t.data("handler"))return a;var a=t.parents(".um-uploader"),t=a.find(".um-uploader-filelist"),u=a.find(".um-uploader-dropzone");if(t.length){a.removeClass("um-upload-completed"),t.umShow(),u.umHide(),i.getOption("multi_selection")||t.find(".um-uploader-file").each(function(e,a){i.removeFile(a.id)});u=t.find("#"+r.id);if(!u.length){t.html("");var o=a.find(".um-uploader-file-placeholder").clone().addClass("um-uploader-file").removeClass("um-uploader-file-placeholder um-display-none").attr("id",r.id),d=[".um-uploaded-value",".um-uploaded-value-hash"];for(let a=0;a<d.length;a++){let e=o.find(d[a]).attr("name");e=e.replace("{{{file_id}}}",r.id),o.find(d[a]).prop("disabled",!1).attr("name",e)}t.append(o),u=t.find("#"+r.id);let e=r.name.split(".").pop();""===r.type&&(e="file"),u.find(".um-file-extension-text").text(e),u.find(".um-supporting-text").text(plupload.formatSize(r.size))}}return!0}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,a,t,i,r){if("field-image"!==a.data("handler"))return e;var e=a.parents(".um-uploader"),u=e.find(".um-uploader-filelist"),o=e.parents(".um-field-uploader-wrapper"),d=e.find(".um-uploader-dropzone");if(u.length){var n,l=e.data("crop");if("user"===l)return n={classes:"um-field-image-modal",duration:400,footer:"",header:wp.i18n.__("Crop image","ultimate-member"),size:"normal",content:r.data[0].modal_content,source:a},UM.profile.avatarModal=UM.modal.addModal(n,null),e.removeClass("um-upload-completed"),u.umHide(),d.umShow(),!0;if("square"===l)return n={classes:"um-field-image-modal",duration:400,footer:"",header:wp.i18n.__("Crop image","ultimate-member"),size:"normal",content:r.data[0].modal_content,source:a},UM.profile.avatarModal=UM.modal.addModal(n,null),e.removeClass("um-upload-completed"),u.umHide(),d.umShow(),!0;o.find(".um-field-image-controls").umShow(),e.addClass("um-upload-completed"),e.find(".um-uploader-file .um-uploader-file-preview").html(r.data[0].lazy_image),e.find(".um-uploader-file").find(".um-uploader-file-data").umHide(),UM.frontend.image.lazyload.init(),(l=u.find("#"+i.id)).find(".um-uploaded-value").val(r.data[0].name_saved),l.find(".um-uploaded-value-hash").val(r.data[0].hash)}return null}),wp.hooks.addFilter("um_uploader_file_filtered","ultimate-member",function(a,t,i,r){if("field-file"!==t.data("handler"))return a;var a=t.parents(".um-uploader"),t=a.find(".um-uploader-filelist"),u=a.find(".um-uploader-dropzone");if(t.length){a.removeClass("um-upload-completed"),t.umShow(),u.umHide(),i.getOption("multi_selection")||t.find(".um-uploader-file").each(function(e,a){i.removeFile(a.id)});u=t.find("#"+r.id);if(!u.length){t.html("");var o=a.find(".um-uploader-file-placeholder").clone().addClass("um-uploader-file").removeClass("um-uploader-file-placeholder um-display-none").attr("id",r.id),d=[".um-uploaded-value",".um-uploaded-value-hash"];for(let a=0;a<d.length;a++){let e=o.find(d[a]).attr("name");e=e.replace("{{{file_id}}}",r.id),o.find(d[a]).prop("disabled",!1).attr("name",e)}t.append(o),(u=t.find("#"+r.id)).find(".um-uploader-file-name").text(r.name);let e=r.name.split(".").pop();""===r.type&&(e="file"),u.find(".um-file-extension-text").text(e),u.find(".um-supporting-text").text(plupload.formatSize(r.size))}}return!0}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,a,t,i,r){return"field-file"!==a.data("handler")?e:(a=(e=a.parents(".um-uploader")).find(".um-uploader-filelist"),e.parents(".um-field-uploader-wrapper").find(".um-field-file-controls").umShow(),e.addClass("um-upload-completed"),a.length&&((e=a.find("#"+i.id)).find(".um-uploaded-value").val(r.data[0].name_saved),e.find(".um-uploaded-value-hash").val(r.data[0].hash)),null)}),jQuery(document).ready(function(){jQuery(document.body).on("click",".um-user-posts-load-more",function(e){e.preventDefault();let t=jQuery(this),i=t.siblings(".um-user-profile-posts-loop"),r=+t.data("page")+1;t.prop("disabled",!0),t.siblings(".um-user-posts-loader").umShow(),wp.ajax.send("um_get_user_posts",{data:{author:t.data("author"),last_id:t.data("last_id"),nonce:t.data("nonce")},success:function(e){t.prop("disabled",!1),t.siblings(".um-user-posts-loader").umHide(),i.append(e.content);var a=+t.data("pages");r==a?t.remove():(t.data("page",r),t.data("last_id",e.last_id))},error:function(e){t.prop("disabled",!1),t.siblings(".um-user-posts-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-user-comments-load-more",function(e){e.preventDefault();let t=jQuery(this),i=t.siblings(".um-user-profile-comments-loop"),r=+t.data("page")+1;t.prop("disabled",!0),t.siblings(".um-user-comments-loader").umShow(),wp.ajax.send("um_get_user_comments",{data:{author:t.data("author"),last_id:t.data("last_id"),nonce:t.data("nonce")},success:function(e){t.prop("disabled",!1),t.siblings(".um-user-comments-loader").umHide(),i.append(e.content);var a=+t.data("pages");r==a?t.remove():(t.data("page",r),t.data("last_id",e.last_id))},error:function(e){t.prop("disabled",!1),t.siblings(".um-user-comments-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-user-action.um_delete",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to delete this user?","ultimate-member")))return wp.hooks.addFilter("um_dropdown_link_result","ultimate-member",function(e,a){return"um-user-action um_delete um-destructive"!==a&&e}),!1;wp.hooks.removeFilter("um_dropdown_link_result","ultimate-member")}),jQuery(document.body).on("click",".um-user-action.um_switch_user",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to switch to this user? It breaks your current session.","ultimate-member")))return wp.hooks.addFilter("um_dropdown_link_result","ultimate-member",function(e,a){return"um-user-action um_switch_user"!==a&&e}),!1;wp.hooks.removeFilter("um_dropdown_link_result","ultimate-member")}),jQuery(document.body).on("click",".um-photo-modal",function(e){e.preventDefault();jQuery(this).data("src");e=jQuery(this).html();return UM.modal.addModal({classes:"um-profile-field-photo-modal",duration:400,footer:"",header:"",size:"large",content:e,template:'<div class="um-modal"><span class="um-modal-close um-modal-close-fixed">&times;</span><div class="um-modal-body"></div></div>'},null),!1}),jQuery(document.body).on("click",".um-modal-field-image-decline",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel crop of this image and remove it?","ultimate-member")))return!1;var e=jQuery(this),a=e.siblings(".um-ajax-spinner-svg"),t=e.parents(".um-modal-buttons-wrapper").find(".um-button"),e=e.data("form_field");t.prop("disabled",!0),a.show(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close();wp.hooks.addFilter("um-field-image-remove-confirm-text","ultimate-member",function(e,a){return e=a.hasClass("um-field-image-remove")?"":e}),jQuery("#"+e).find(".um-field-image-remove").trigger("click"),wp.hooks.removeFilter("um-field-image-remove-confirm-text","ultimate-member")}),jQuery(document.body).on("click",".um-apply-field-image-crop",function(a){a.preventDefault();a=jQuery(this);if(0<a.parents(".um-modal-body").find(".cropper-hidden").length&&UM.frontend.cropper.obj){let e=a.siblings(".um-ajax-spinner-svg");var i=a.parents(".um-modal-buttons-wrapper").find(".um-button");let t=a.data("user_id");var a=a.data("nonce"),r=UM.frontend.cropper.obj.getData(),r=Math.round(r.x)+","+Math.round(r.y)+","+Math.round(r.width)+","+Math.round(r.height);r&&(i.prop("disabled",!0),e.show(),wp.ajax.send("um_resize_image",{data:{coord:r,user_id:t,nonce:a},success:function(a){jQuery('[data-um-modal-opened="1"]').siblings(".um-avatar").find("> img").replaceWith(a.avatar),a.all_sizes&&$.each(a.all_sizes,function(e){$(".um-avatar-"+e+'[data-user_id="'+t+'"]').find("> img").replaceWith(a.all_sizes[e])}),e.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){console.log(e)}}))}}),jQuery(document.body).on("click",".um-finish-upload.image:not(.disabled)",function(){var a,e,t=jQuery(this),i=jQuery(this).attr("data-key"),r=jQuery(this).parents(".um-modal-body").find(".um-single-image-preview"),u=r.find("img").attr("src"),r=r.find("img").data("file"),o=0,d=(jQuery(this).parents("#um_upload_single").data("user_id")&&(o=jQuery(this).parents("#um_upload_single").data("user_id")),0),n="";1===jQuery('div.um-field-image[data-key="'+i+'"]').length&&(d=(e=jQuery('div.um-field-image[data-key="'+i+'"]').closest(".um-form")).find('input[name="form_id"]').val(),n=e.attr("data-mode")),0<jQuery(".cropper-hidden").length&&UM.frontend.cropper.obj?(e=UM.frontend.cropper.obj.getData(),e=Math.round(e.x)+","+Math.round(e.y)+","+Math.round(e.width)+","+Math.round(e.height),jQuery(this).html(jQuery(this).attr("data-processing")).addClass("disabled"),jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_resize_image",src:u,coord:e,user_id:o,key:i,set_id:d,set_mode:n,nonce:um_scripts.nonce},success:function(e){e.success&&(a=new Date,"profile_photo"===i?jQuery(".um-profile-photo-img img").attr("src",e.data.image.source_url+"?"+a.getTime()):"cover_photo"===i&&(jQuery(".um-cover-e").empty().html('<img src="'+e.data.image.source_url+"?"+a.getTime()+'" alt="" />'),jQuery(".um").hasClass("um-editing"))&&jQuery(".um-cover-overlay").show(),jQuery(".um-single-image-preview[data-key="+i+"]").fadeIn().find("img").attr("src",e.data.image.source_url+"?"+a.getTime()),um_remove_modal(),jQuery("img.cropper-invisible").remove(),jQuery(".um-single-image-preview[data-key="+i+"]").parents(".um-field").find(".um-btn-auto-width").html(t.attr("data-change")),jQuery(".um-single-image-preview[data-key="+i+"]").parents(".um-field").find('input[type="hidden"]').val(e.data.image.filename))}})):(a=new Date,jQuery(".um-single-image-preview[data-key="+i+"]").fadeIn().find("img").attr("src",u+"?"+a.getTime()),um_remove_modal(),jQuery(".um-single-image-preview[data-key="+i+"]").parents(".um-field").find(".um-btn-auto-width").html(t.attr("data-change")),jQuery(".um-single-image-preview[data-key="+i+"]").parents(".um-field").find("input[type=hidden]").val(r))}),jQuery(".um-profile.um-viewing .um-profile-body .um-row").each(function(){var e=jQuery(this);0==e.find(".um-field").length&&(e.prev(".um-row-heading").remove(),e.remove())}),jQuery(".um-profile.um-viewing .um-profile-body").length&&0==jQuery(".um-profile.um-viewing .um-profile-body").find(".um-field").length&&(jQuery(".um-profile.um-viewing .um-profile-body").find(".um-row-heading,.um-row").remove(),jQuery(".um-profile-note").show()),jQuery(document.body).on("click",".um-profile-save",function(e){return e.preventDefault(),jQuery(this).parents(".um.um-profile.um-editing").find("form").trigger("submit"),!1}),jQuery(document.body).on("change keyup","#um-meta-bio",function(){if(void 0!==jQuery(this).val()){var a=jQuery(this).data("character-limit"),t=jQuery(this).data("html");let e=a-jQuery(this).val().length;e=(e=1===parseInt(t)?a-jQuery(this).val().replace(/(<([^>]+)>)/gi,"").length:e)<0?0:e,jQuery("span.um-meta-bio-character span.um-bio-limit").text(e);t=e<5?"red":"";jQuery("span.um-meta-bio-character").css("color",t)}}),jQuery("#um-meta-bio").trigger("change"),jQuery(".um-profile form").each(function(){let a=jQuery(this).data("description_key");jQuery(this).find('textarea[name="'+a+'"]').length&&jQuery(document.body).on("change input",'textarea[name="'+a+'"]',function(e){jQuery(this).parents("form").find('textarea[name="'+a+'"]').each(function(){jQuery(this).val(e.currentTarget.value),jQuery("#um-meta-bio")[0]!==e.currentTarget&&jQuery("#um-meta-bio")[0]===jQuery(this)[0]&&jQuery(this).trigger("change")})})}),jQuery(".um-profile-nav a").on("touchend",function(e){jQuery(e.currentTarget).trigger("click")})});