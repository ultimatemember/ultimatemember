wp.hooks.addFilter("um_uploader_data","ultimate-member",function(e,u,i){return("field-image"===u||"field-file"===u)&&((u=i.parents("form").find('input[name="user_id"]')).length&&(u=u.val())&&(e.url+="&user_id="+u),(u=i.parents("form").find('input[name="form_id"]')).length&&(u=u.val())&&(e.url+="&form_id="+u),u=i.parents(".um-field").data("key"))&&(e.url+="&field_id="+u),e}),wp.hooks.addFilter("um_uploader_file_filtered","ultimate-member",function(u,i,t,r){var a=i.data("handler");if("field-image"!==a&&"field-file"!==a)return u;a=i.parents(".um-uploader"),u=a.find(".um-uploader-filelist"),i=a.find(".um-uploader-dropzone");if(u.length){u.umShow(),i.umHide(),t.getOption("multi_selection")||u.find(".um-uploader-file").each(function(e,u){t.removeFile(u.id)});i=u.find("#"+r.id);if(!i.length){var o=a.find(".um-uploader-file-placeholder").clone().addClass("um-uploader-file").removeClass("um-uploader-file-placeholder um-display-none").attr("id",r.id),n=[".um-uploaded-value",".um-uploaded-value-hash"];for(let u=0;u<n.length;u++){let e=o.find(n[u]).attr("name");e=e.replace("{{{file_id}}}",r.id),o.find(n[u]).prop("disabled",!1).attr("name",e)}u.append(o),(i=u.find("#"+r.id)).find(".um-uploader-file-name").text(r.name);let e=r.name.split(".").pop();""===r.type&&(e="file"),i.find(".um-file-extension-text").text(e),i.find(".um-supporting-text").text(plupload.formatSize(r.size)),u.hasClass("um-uploader-filelist-sortable")&&u.sortable()}}return!0}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,u,i,t,r){var a=u.data("handler");return"field-image"!==a&&"field-file"!==a?e:((a=u.parents(".um-uploader").find(".um-uploader-filelist")).length&&((e=a.find("#"+t.id)).find(".um-uploaded-value").val(r.data[0].name_saved),e.find(".um-uploaded-value-hash").val(r.data[0].hash)),null)}),jQuery(document).ready(function(){jQuery(document.body).on("click",".um-user-posts-load-more",function(e){e.preventDefault();let i=jQuery(this),t=i.siblings(".um-user-profile-posts-loop"),r=+i.data("page")+1;i.prop("disabled",!0),i.siblings(".um-user-posts-loader").umShow(),wp.ajax.send("um_get_user_posts",{data:{author:i.data("author"),last_id:i.data("last_id"),nonce:i.data("nonce")},success:function(e){i.prop("disabled",!1),i.siblings(".um-user-posts-loader").umHide(),t.append(e.content);var u=+i.data("pages");r==u?i.remove():(i.data("page",r),i.data("last_id",e.last_id))},error:function(e){i.prop("disabled",!1),i.siblings(".um-user-posts-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-user-comments-load-more",function(e){e.preventDefault();let i=jQuery(this),t=i.siblings(".um-user-profile-comments-loop"),r=+i.data("page")+1;i.prop("disabled",!0),i.siblings(".um-user-comments-loader").umShow(),wp.ajax.send("um_get_user_comments",{data:{author:i.data("author"),last_id:i.data("last_id"),nonce:i.data("nonce")},success:function(e){i.prop("disabled",!1),i.siblings(".um-user-comments-loader").umHide(),t.append(e.content);var u=+i.data("pages");r==u?i.remove():(i.data("page",r),i.data("last_id",e.last_id))},error:function(e){i.prop("disabled",!1),i.siblings(".um-user-comments-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-user-action.um_delete",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to delete this user?","ultimate-member")))return wp.hooks.addFilter("um_dropdown_link_result","ultimate-member",function(e,u){return"um-user-action um_delete um-destructive"!==u&&e}),!1;wp.hooks.removeFilter("um_dropdown_link_result","ultimate-member")}),jQuery(document.body).on("click",".um-user-action.um_switch_user",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to switch to this user? It breaks your current session.","ultimate-member")))return wp.hooks.addFilter("um_dropdown_link_result","ultimate-member",function(e,u){return"um-user-action um_switch_user"!==u&&e}),!1;wp.hooks.removeFilter("um_dropdown_link_result","ultimate-member")}),jQuery(document.body).on("click",".um-photo-modal",function(e){e.preventDefault();jQuery(this).data("src");e=jQuery(this).html();return UM.modal.addModal({classes:"um-profile-field-photo-modal",duration:400,footer:"",header:"",size:"large",content:e,template:'<div class="um-modal"><span class="um-modal-close um-modal-close-fixed">&times;</span><div class="um-modal-body"></div></div>'},null),!1}),jQuery(document.body).on("click",".um-field-image-change",function(e){e.preventDefault();e=jQuery(this).parents(".um-field");e.find(".um-field-value").umHide(),e.find(".um-field-uploader-wrapper").umShow()}),jQuery(document.body).on("click",".um-field-file-change",function(e){e.preventDefault();e=jQuery(this).parents(".um-field");e.find(".um-field-value").umHide(),e.find(".um-field-uploader-wrapper").umShow()}),jQuery(document.body).on("click",".um-field-image-uploader-cancel",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel uploader process? You cannot restore already uploaded image.","ultimate-member")))return!1;e=jQuery(this).parents(".um-field");e.find(".um-field-value").umShow(),e.find(".um-field-uploader-wrapper").umHide()}),jQuery(document.body).on("click",".um-field-file-uploader-cancel",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel uploader process? You cannot restore already uploaded file.","ultimate-member")))return!1;e=jQuery(this).parents(".um-field");e.find(".um-field-value").umShow(),e.find(".um-field-uploader-wrapper").umHide()}),jQuery(document.body).on("click",".um-field-image-remove",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to remove this image?","ultimate-member")))return!1;var e=jQuery(this).parents(".um-field"),u=e.find(".um-field-uploader-wrapper");u.umShow(),u.find(".um-field-image-uploader-cancel").umHide(),e.find(".um-field-value").remove()}),jQuery(document.body).on("click",".um-field-file-remove",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to remove this file?","ultimate-member")))return!1;var e=jQuery(this).parents(".um-field"),u=e.find(".um-field-uploader-wrapper");u.umShow(),u.find(".um-field-file-uploader-cancel").umHide(),e.find(".um-field-value").remove()}),jQuery(".um-profile.um-viewing .um-profile-body .um-row").each(function(){var e=jQuery(this);0==e.find(".um-field").length&&(e.prev(".um-row-heading").remove(),e.remove())}),jQuery(".um-profile.um-viewing .um-profile-body").length&&0==jQuery(".um-profile.um-viewing .um-profile-body").find(".um-field").length&&(jQuery(".um-profile.um-viewing .um-profile-body").find(".um-row-heading,.um-row").remove(),jQuery(".um-profile-note").show()),jQuery(document.body).on("click",".um-profile-save",function(e){return e.preventDefault(),jQuery(this).parents(".um.um-profile.um-editing").find("form").trigger("submit"),!1}),jQuery(document.body).on("change keyup","#um-meta-bio",function(){if(void 0!==jQuery(this).val()){var u=jQuery(this).data("character-limit"),i=jQuery(this).data("html");let e=u-jQuery(this).val().length;e=(e=1===parseInt(i)?u-jQuery(this).val().replace(/(<([^>]+)>)/gi,"").length:e)<0?0:e,jQuery("span.um-meta-bio-character span.um-bio-limit").text(e);i=e<5?"red":"";jQuery("span.um-meta-bio-character").css("color",i)}}),jQuery("#um-meta-bio").trigger("change"),jQuery(".um-profile form").each(function(){let u=jQuery(this).data("description_key");jQuery(this).find('textarea[name="'+u+'"]').length&&jQuery(document.body).on("change input",'textarea[name="'+u+'"]',function(e){jQuery(this).parents("form").find('textarea[name="'+u+'"]').each(function(){jQuery(this).val(e.currentTarget.value),jQuery("#um-meta-bio")[0]!==e.currentTarget&&jQuery("#um-meta-bio")[0]===jQuery(this)[0]&&jQuery(this).trigger("change")})})}),jQuery(".um-profile-nav a").on("touchend",function(e){jQuery(e.currentTarget).trigger("click")})});