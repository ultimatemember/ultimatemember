jQuery(document).ready(function(){jQuery(document.body).on("click",".um-user-action",function(e){if(e.preventDefault(),jQuery(this).data("confirm-onclick")&&!confirm(jQuery(this).data("confirm-onclick")))return wp.hooks.addFilter("um_dropdown_link_result","ultimate-member",function(e,r,a){return!a.data("confirm-onclick")&&e}),!1;wp.hooks.removeFilter("um_dropdown_link_result","ultimate-member")}),jQuery(document.body).on("click",".um-user-posts-load-more",function(e){e.preventDefault();let a=jQuery(this),o=a.siblings(".um-user-profile-posts-loop"),t=+a.data("page")+1;a.prop("disabled",!0),a.siblings(".um-user-posts-loader").umShow(),wp.ajax.send("um_get_user_posts",{data:{author:a.data("author"),last_id:a.data("last_id"),nonce:a.data("nonce")},success:function(e){a.prop("disabled",!1),a.siblings(".um-user-posts-loader").umHide(),o.append(e.content);var r=+a.data("pages");t==r?a.remove():(a.data("page",t),a.data("last_id",e.last_id))},error:function(e){a.prop("disabled",!1),a.siblings(".um-user-posts-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-user-comments-load-more",function(e){e.preventDefault();let a=jQuery(this),o=a.siblings(".um-user-profile-comments-loop"),t=+a.data("page")+1;a.prop("disabled",!0),a.siblings(".um-user-comments-loader").umShow(),wp.ajax.send("um_get_user_comments",{data:{author:a.data("author"),last_id:a.data("last_id"),nonce:a.data("nonce")},success:function(e){a.prop("disabled",!1),a.siblings(".um-user-comments-loader").umHide(),o.append(e.content);var r=+a.data("pages");t==r?a.remove():(a.data("page",t),a.data("last_id",e.last_id))},error:function(e){a.prop("disabled",!1),a.siblings(".um-user-comments-loader").umHide(),console.log(e)}})}),jQuery(document.body).on("click",".um-photo-modal",function(e){e.preventDefault();jQuery(this).data("src");e=jQuery(this).html();return UM.modal.addModal({classes:"um-profile-field-photo-modal",duration:400,footer:"",header:"",size:"large",content:e,template:'<div class="um-modal"><span class="um-modal-close um-modal-close-fixed">&times;</span><div class="um-modal-body"></div></div>'},null),!1}),jQuery(document.body).on("click",".um-modal-field-image-decline",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel crop of this image and remove it?","ultimate-member")))return!1;var e=jQuery(this),r=e.siblings(".um-ajax-spinner-svg"),a=e.parents(".um-modal-buttons-wrapper").find(".um-button"),e=e.data("form_field");a.prop("disabled",!0),r.show(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close();wp.hooks.addFilter("um-field-image-remove-confirm-text","ultimate-member",function(e,r){return e=r.hasClass("um-field-image-remove")?"":e}),jQuery("#"+e).find(".um-field-image-remove").trigger("click"),wp.hooks.removeFilter("um-field-image-remove-confirm-text","ultimate-member")}),jQuery(document.body).on("click",".um-apply-field-image-crop",function(r){r.preventDefault();r=jQuery(this);if(0<r.parents(".um-modal-body").find(".cropper-hidden").length&&UM.frontend.cropper.obj){let e=r.siblings(".um-ajax-spinner-svg");var t=r.parents(".um-modal-buttons-wrapper").find(".um-button");let a=r.data("user_id");var i=r.data("form_id");let o=r.data("field_id");var u=r.data("nonce"),n=r.data("temp_hash"),r=r.parents(".um-modal-body").find(".cropper-hidden").attr("src"),d=UM.frontend.cropper.obj.getData(),d=Math.round(d.x)+","+Math.round(d.y)+","+Math.round(d.width)+","+Math.round(d.height);d&&(t.prop("disabled",!0),e.show(),wp.ajax.send("um_crop_image",{data:{src:r,temp_hash:n,coord:d,user_id:a,field_id:o,form_id:i,nonce:u},success:function(r){jQuery('[data-um-modal-opened="1"]').siblings(".um-avatar").find("> img").replaceWith(r.avatar),r.all_sizes&&$.each(r.all_sizes,function(e){$(".um-avatar-"+e+'[data-user_id="'+a+'"]').find("> img").replaceWith(r.all_sizes[e])}),r.image.file_preview&&(jQuery('[data-key="'+o+'"]').find(".um-uploader-file-preview").html(r.image.file_preview),jQuery('[data-key="'+o+'"]').find(".um-uploader-dropzone").umHide(),jQuery('[data-key="'+o+'"]').find(".um-uploader-filelist").umShow(),jQuery('[data-key="'+o+'"]').find(".um-uploader").addClass("um-upload-completed"),UM.frontend.image.lazyload.init()),e.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){console.log(e)}}))}}),jQuery(".um-profile.um-viewing .um-profile-body .um-row").each(function(){var e=jQuery(this);0==e.find(".um-field").length&&(e.prev(".um-row-heading").remove(),e.remove())}),jQuery(".um-profile.um-viewing .um-profile-body").length&&0==jQuery(".um-profile.um-viewing .um-profile-body").find(".um-field").length&&(jQuery(".um-profile.um-viewing .um-profile-body").find(".um-row-heading,.um-row").remove(),jQuery(".um-profile-note").show()),jQuery(document.body).on("click",".um-profile-save",function(e){return e.preventDefault(),jQuery(this).parents(".um.um-profile.um-editing").find("form").trigger("submit"),!1}),jQuery(document.body).on("change keyup","#um-meta-bio",function(){if(void 0!==jQuery(this).val()){var r=jQuery(this).data("character-limit"),a=jQuery(this).data("html");let e=r-jQuery(this).val().length;e=(e=1===parseInt(a)?r-jQuery(this).val().replace(/(<([^>]+)>)/gi,"").length:e)<0?0:e,jQuery("span.um-meta-bio-character span.um-bio-limit").text(e);a=e<5?"red":"";jQuery("span.um-meta-bio-character").css("color",a)}}),jQuery("#um-meta-bio").trigger("change"),jQuery(".um-profile form").each(function(){let r=jQuery(this).data("description_key");jQuery(this).find('textarea[name="'+r+'"]').length&&jQuery(document.body).on("change input",'textarea[name="'+r+'"]',function(e){jQuery(this).parents("form").find('textarea[name="'+r+'"]').each(function(){jQuery(this).val(e.currentTarget.value),jQuery("#um-meta-bio")[0]!==e.currentTarget&&jQuery("#um-meta-bio")[0]===jQuery(this)[0]&&jQuery(this).trigger("change")})})}),jQuery(".um-profile-nav a").on("touchend",function(e){jQuery(e.currentTarget).trigger("click")})});