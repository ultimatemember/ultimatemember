wp.hooks.addFilter("um_uploader_data","ultimate-member",function(e,a,d){var l;return"field-image"!==a&&"field-file"!==a||(e.filters.prevent_duplicates=!1,(l=d.parents("form").find('input[name="user_id"]')).length&&(l=l.val())&&(e.url+="&user_id="+l),(l=d.parents("form").find('input[name="form_id"]')).length&&(l=l.val())&&(e.url+="&form_id="+l),(l=d.parents(".um-field").data("key"))&&(e.url+="&field_id="+l),"field-image"===a&&(e.url+="&crop="+d.parents(".um-uploader").data("crop"))),e}),wp.hooks.addFilter("um_uploader_file_filtered","ultimate-member",function(a,d,l,i){if("field-image"!==d.data("handler"))return a;var a=d.parents(".um-uploader"),d=a.find(".um-uploader-filelist"),o=a.find(".um-uploader-dropzone");if(d.length){a.removeClass("um-upload-completed"),d.umShow(),o.umHide(),l.getOption("multi_selection")||d.find(".um-uploader-file").each(function(e,a){l.removeFile(a.id)});o=d.find("#"+i.id);if(!o.length){d.html("");var t=a.find(".um-uploader-file-placeholder").clone().addClass("um-uploader-file").removeClass("um-uploader-file-placeholder um-display-none").attr("id",i.id),u=[".um-uploaded-value",".um-uploaded-value-hash",".um-uploaded-value-temp-hash"];for(let a=0;a<u.length;a++){let e=t.find(u[a]).attr("name");e=e.replace("{{{file_id}}}",i.id),t.find(u[a]).prop("disabled",!1).attr("name",e)}d.append(t),o=d.find("#"+i.id);let e=i.name.split(".").pop();""===i.type&&(e="file"),o.find(".um-file-extension-text").text(e),o.find(".um-supporting-text").text(plupload.formatSize(i.size))}}return!0}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,a,d,l,i){if("field-image"!==a.data("handler"))return e;var e=a.parents(".um-uploader"),o=e.find(".um-uploader-filelist"),t=e.parents(".um-field-uploader-wrapper"),u=e.find(".um-uploader-dropzone");if(o.length){var r,n=e.data("crop");if("user"===n)return r={classes:"um-field-image-modal",duration:400,footer:"",header:wp.i18n.__("Crop image","ultimate-member"),size:"normal",content:i.data[0].modal_content,source:a,attributes:{"data-file-id":l.id}},UM.profile.avatarModal=UM.modal.addModal(r,null),e.removeClass("um-upload-completed"),o.umHide(),u.umShow(),o.find("#"+l.id).data("filename",i.data[0].name_saved).data("temp_hash",i.data[0].temp_hash).data("nonce",i.data[0].delete_nonce),!0;if("square"===n||"cover"===n)return r={classes:"um-field-image-modal",duration:400,footer:"",header:wp.i18n.__("Crop image","ultimate-member"),size:"normal",content:i.data[0].modal_content,source:a,attributes:{"data-file-id":l.id}},UM.profile.avatarModal=UM.modal.addModal(r,null),e.removeClass("um-upload-completed"),o.umHide(),u.umShow(),o.find("#"+l.id).data("filename",i.data[0].name_saved).data("temp_hash",i.data[0].temp_hash).data("nonce",i.data[0].delete_nonce),!0;t.find(".um-field-image-controls").umShow(),e.addClass("um-upload-completed"),e.find(".um-uploader-file .um-uploader-file-preview").html(i.data[0].lazy_image),e.find(".um-uploader-file").find(".um-uploader-file-data").umHide(),UM.frontend.image.lazyload.init(),(n=o.find("#"+l.id)).find(".um-uploaded-value").val(i.data[0].name_saved),n.find(".um-uploaded-value-hash").val(i.data[0].hash),n.find(".um-uploaded-value-temp-hash").val(i.data[0].temp_hash),e.find(".um-uploaded-value-hidden").prop("disabled",!0),e.find(".um-uploaded-value-hash-hidden").prop("disabled",!0),e.find(".um-uploaded-value-temp-hash-hidden").prop("disabled",!0),n.data("filename",i.data[0].name_saved).data("temp_hash",i.data[0].temp_hash).data("nonce",i.data[0].delete_nonce),wp.hooks.doAction("um_uploader_image_file_uploaded",e,t,n)}return null}),wp.hooks.addFilter("um_uploader_file_filtered","ultimate-member",function(a,d,l,i){if("field-file"!==d.data("handler"))return a;var a=d.parents(".um-uploader"),d=a.find(".um-uploader-filelist"),o=a.find(".um-uploader-dropzone");if(d.length){a.removeClass("um-upload-completed"),d.umShow(),o.umHide(),l.getOption("multi_selection")||d.find(".um-uploader-file").each(function(e,a){l.removeFile(a.id)});o=d.find("#"+i.id);if(!o.length){d.html("");var t=a.find(".um-uploader-file-placeholder").clone().addClass("um-uploader-file").removeClass("um-uploader-file-placeholder um-display-none").attr("id",i.id),u=[".um-uploaded-value",".um-uploaded-value-hash",".um-uploaded-value-temp-hash"];for(let a=0;a<u.length;a++){let e=t.find(u[a]).attr("name");e=e.replace("{{{file_id}}}",i.id),t.find(u[a]).prop("disabled",!1).attr("name",e)}d.append(t),(o=d.find("#"+i.id)).find(".um-uploader-file-name").text(i.name);let e=i.name.split(".").pop();""===i.type&&(e="file"),o.find(".um-file-extension-text").text(e),o.find(".um-supporting-text").text(plupload.formatSize(i.size))}}return!0}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,a,d,l,i){return"field-file"!==a.data("handler")?e:(a=(e=a.parents(".um-uploader")).find(".um-uploader-filelist"),e.parents(".um-field-uploader-wrapper").find(".um-field-file-controls").umShow(),e.addClass("um-upload-completed"),a.length&&((a=a.find("#"+l.id)).find(".um-uploaded-value").val(i.data[0].name_saved),a.find(".um-uploaded-value-hash").val(i.data[0].hash),a.find(".um-uploaded-value-temp-hash").val(i.data[0].temp_hash),e.find(".um-uploaded-value-hidden").prop("disabled",!0),e.find(".um-uploaded-value-hash-hidden").prop("disabled",!0),e.find(".um-uploaded-value-temp-hash-hidden").prop("disabled",!0)),null)}),jQuery(document).ready(function(){jQuery(document.body).on("click",".um-photo-modal",function(e){e.preventDefault();e='<img class="um-photo-modal-img" src="'+jQuery(this).data("src")+'" alt="'+jQuery(this).find(".um-image-lazyload").attr("alt")+'"/>';return UM.modal.addModal({classes:"um-profile-field-photo-modal",duration:400,footer:"",header:"",size:"large",content:e,template:'<div class="um-modal"><span class="um-modal-close um-modal-close-fixed">&times;</span><div class="um-modal-body"></div></div>'},null),!1}),jQuery(document.body).on("click",".um-modal-field-image-decline",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel crop of this image and remove it?","ultimate-member")))return!1;var e=jQuery(this),a=e.siblings(".um-ajax-spinner-svg"),d=e.parents(".um-modal-buttons-wrapper").find(".um-button"),e=e.data("form_field");d.prop("disabled",!0),a.show(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close();wp.hooks.addFilter("um-field-image-remove-confirm-text","ultimate-member",function(e,a){return e=a.hasClass("um-field-image-remove")?"":e}),jQuery("#"+e).find(".um-field-image-remove").trigger("click"),wp.hooks.removeFilter("um-field-image-remove-confirm-text","ultimate-member")}),jQuery(document.body).on("click",".um-apply-field-image-crop",function(e){e.preventDefault();e=jQuery(this);if(0<e.parents(".um-modal-body").find(".cropper-hidden").length&&UM.frontend.cropper.obj){let l=e.siblings(".um-ajax-spinner-svg");var a=e.parents(".um-modal-buttons-wrapper").find(".um-button"),d=e.data("user_id"),u=e.data("form_id");let i=e.data("field_id");var r=e.data("nonce");let o=e.data("temp_hash"),t=e.parents(".um-modal").data("file-id");var e=e.parents(".um-modal-body").find(".cropper-hidden").attr("src"),n=UM.frontend.cropper.obj.getData(),n=Math.round(n.x)+","+Math.round(n.y)+","+Math.round(n.width)+","+Math.round(n.height);n&&(a.prop("disabled",!0),l.show(),wp.ajax.send("um_crop_image",{data:{src:e,temp_hash:o,coord:n,user_id:d,field_id:i,form_id:u,nonce:r},success:function(e){var a,d;e.file_preview&&((a=jQuery('[data-key="'+i+'"]')).find(".um-uploader-file-preview").html(e.file_preview),a.find(".um-uploader-dropzone").umHide(),a.find(".um-uploader-filelist").umShow(),a.find(".um-uploader").addClass("um-upload-completed"),a.find(".um-field-image-controls").umShow(),(d=a.find("#"+t)).find(".um-uploaded-value").val(e.filename),d.find(".um-uploaded-value-hash").val(e.hash),d.find(".um-uploaded-value-temp-hash").val(o),a.find(".um-uploaded-value-hidden").prop("disabled",!0),a.find(".um-uploaded-value-hash-hidden").prop("disabled",!0),a.find(".um-uploaded-value-temp-hash-hidden").prop("disabled",!0),UM.frontend.image.lazyload.init(),wp.hooks.doAction("um_uploader_image_file_cropped",a,d,e)),l.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){console.log(e)}}))}})});