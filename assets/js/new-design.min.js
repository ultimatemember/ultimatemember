"object"!=typeof window.UM&&(window.UM={}),"object"!=typeof UM.profile&&(UM.profile={}),UM.profile={avatarModal:null,avatarCropper:null},jQuery(document).ready(function(i){i(document.body).on("click",".um-modal-field-image-decline",function(e){if(e.preventDefault(),!confirm(wp.i18n.__("Are you sure that you want to cancel crop of this image and remove it?","ultimate-member")))return!1;var e=i(this),r=e.siblings(".um-ajax-spinner-svg"),a=e.parents(".um-modal-buttons-wrapper").find(".um-button"),e=e.data("field");a.prop("disabled",!0),r.show(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close();wp.hooks.addFilter("um-field-image-remove-confirm-text","ultimate-member",function(e,r){return e=r.hasClass("um-field-image-remove")?"":e}),i("#"+e).find(".um-field-image-remove").trigger("click"),wp.hooks.removeFilter("um-field-image-remove-confirm-text","ultimate-member")}),i(document.body).on("click",".um-finish-upload.image:not(.disabled)",function(){var r,e,a=jQuery(this),t=jQuery(this).attr("data-key"),o=jQuery(this).parents(".um-modal-body").find(".um-single-image-preview"),i=o.find("img").attr("src"),o=o.find("img").data("file"),n=0,d=(jQuery(this).parents("#um_upload_single").data("user_id")&&(n=jQuery(this).parents("#um_upload_single").data("user_id")),0),u="";1===jQuery('div.um-field-image[data-key="'+t+'"]').length&&(d=(e=jQuery('div.um-field-image[data-key="'+t+'"]').closest(".um-form")).find('input[name="form_id"]').val(),u=e.attr("data-mode")),0<jQuery(".cropper-hidden").length&&UM.frontend.cropper.obj?(e=UM.frontend.cropper.obj.getData(),e=Math.round(e.x)+","+Math.round(e.y)+","+Math.round(e.width)+","+Math.round(e.height),jQuery(this).html(jQuery(this).attr("data-processing")).addClass("disabled"),jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_resize_image",src:i,coord:e,user_id:n,key:t,set_id:d,set_mode:u,nonce:um_scripts.nonce},success:function(e){e.success&&(r=new Date,"profile_photo"===t?jQuery(".um-profile-photo-img img").attr("src",e.data.image.source_url+"?"+r.getTime()):"cover_photo"===t&&(jQuery(".um-cover-e").empty().html('<img src="'+e.data.image.source_url+"?"+r.getTime()+'" alt="" />'),jQuery(".um").hasClass("um-editing"))&&jQuery(".um-cover-overlay").show(),jQuery(".um-single-image-preview[data-key="+t+"]").fadeIn().find("img").attr("src",e.data.image.source_url+"?"+r.getTime()),um_remove_modal(),jQuery("img.cropper-invisible").remove(),jQuery(".um-single-image-preview[data-key="+t+"]").parents(".um-field").find(".um-btn-auto-width").html(a.attr("data-change")),jQuery(".um-single-image-preview[data-key="+t+"]").parents(".um-field").find('input[type="hidden"]').val(e.data.image.filename))}})):(r=new Date,jQuery(".um-single-image-preview[data-key="+t+"]").fadeIn().find("img").attr("src",i+"?"+r.getTime()),um_remove_modal(),jQuery(".um-single-image-preview[data-key="+t+"]").parents(".um-field").find(".um-btn-auto-width").html(a.attr("data-change")),jQuery(".um-single-image-preview[data-key="+t+"]").parents(".um-field").find("input[type=hidden]").val(o))}),i(document.body).on("click",".um-apply-field-image-crop",function(r){r.preventDefault();r=i(this);if(0<r.parents(".um-modal-body").find(".cropper-hidden").length&&UM.frontend.cropper.obj){let e=r.siblings(".um-ajax-spinner-svg");var t=r.parents(".um-modal-buttons-wrapper").find(".um-button");let a=r.data("user_id");var r=r.data("nonce"),o=UM.frontend.cropper.obj.getData(),o=Math.round(o.x)+","+Math.round(o.y)+","+Math.round(o.width)+","+Math.round(o.height);o&&(t.prop("disabled",!0),e.show(),wp.ajax.send("um_apply_profile_photo_change",{data:{coord:o,user_id:a,nonce:r},success:function(r){i('[data-um-modal-opened="1"]').siblings(".um-avatar").find("> img").replaceWith(r.avatar),r.all_sizes&&i.each(r.all_sizes,function(e){i(".um-avatar-"+e+'[data-user_id="'+a+'"]').find("> img").replaceWith(r.all_sizes[e])}),e.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){console.log(e)}}))}}),i(document.body).on("click",".um-modal-avatar-decline",function(e){e.preventDefault();e=i(this);let r=e.siblings(".um-ajax-spinner-svg"),a=e.parents(".um-modal-buttons-wrapper").find(".um-button");var t=e.data("user_id"),e=e.data("nonce");a.prop("disabled",!0),r.show(),wp.ajax.send("um_decline_profile_photo_change",{data:{user_id:t,nonce:e},success:function(){r.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){a.prop("disabled",!1),r.hide(),console.log(e)}})}),i(document.body).on("click",".um-apply-avatar-crop",function(r){r.preventDefault();r=i(this);if(0<r.parents(".um-modal-body").find(".cropper-hidden").length&&UM.frontend.cropper.obj){let e=r.siblings(".um-ajax-spinner-svg");var t=r.parents(".um-modal-buttons-wrapper").find(".um-button");let a=r.data("user_id");var r=r.data("nonce"),o=UM.frontend.cropper.obj.getData(),o=Math.round(o.x)+","+Math.round(o.y)+","+Math.round(o.width)+","+Math.round(o.height);o&&(t.prop("disabled",!0),e.show(),wp.ajax.send("um_apply_profile_photo_change",{data:{coord:o,user_id:a,nonce:r},success:function(r){i('[data-um-modal-opened="1"]').siblings(".um-avatar").find("> img").replaceWith(r.avatar),r.all_sizes&&i.each(r.all_sizes,function(e){i(".um-avatar-"+e+'[data-user_id="'+a+'"]').find("> img").replaceWith(r.all_sizes[e])}),e.hide(),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy(),UM.modal.close()},error:function(e){console.log(e)}}))}})}),wp.hooks.addAction("um-modal-shown","ultimate-member",function(e){e.find(".um-modal-crop-wrapper").length&&UM.frontend.cropper.init()},10,1),wp.hooks.addAction("um-modal-shown","ultimate-member",function(e){e.find(".um-modal-crop-wrapper").length&&UM.frontend.cropper.init()},10,1),wp.hooks.addAction("um-modal-before-close","ultimate-member",function(e){e.find(".um-modal-avatar-decline:not(:disabled)").length&&e.find(".um-modal-avatar-decline").trigger("click"),e.find(".um-modal-field-image-decline:not(:disabled)").length&&e.find(".um-modal-field-image-decline").trigger("click"),UM.frontend.cropper.obj&&UM.frontend.cropper.destroy()}),jQuery(document).ready(function(e){jQuery(document.body).on("click",".um-toggle-password",function(){var e=jQuery(this).closest(".um-field-area-password").find("input");"text"===e.attr("type")?e.attr("type","password"):e.attr("type","text"),jQuery(this).toggleClass("um-icon-eye um-icon-eye-disabled")}),jQuery(document.body).on("keydown","#single_user_password-export-request",function(e){var r;jQuery(this).hasClass("um-error")&&(r=jQuery(this).parents("form").find("#um_account_request_download_data").data("hint"),jQuery(this).parents(".um-field").find(".um-field-hint").removeClass("um-field-error").removeAttr("id").html(r),jQuery(this).removeClass("um-error").removeAttr("aria-errormessage"))}),jQuery(document.body).on("keydown","#single_user_password-erase-request",function(e){var r;jQuery(this).hasClass("um-error")&&(r=jQuery(this).parents("form").find("#um_account_request_erase_data").data("hint"),jQuery(this).parents(".um-field").find(".um-field-hint").removeClass("um-field-error").removeAttr("id").html(r),jQuery(this).removeClass("um-error").removeAttr("aria-errormessage"))}),jQuery(document.body).on("click","#um_account_request_download_data",function(e){e.preventDefault();e={nonce:jQuery(this).data("nonce")};let t=jQuery(this).siblings(".um-ajax-spinner-svg"),o=(t.show(),jQuery(this).parents("form").find("#single_user_password-export-request"));var r="um-error-for-single_user_password-export-request",a=o.parents(".um-field");if(o.length){if(""===o.val())return a.find(".um-field-hint").data("hint",a.find(".um-field-hint").html()).addClass("um-field-error").attr("id",r).html(jQuery(this).data("error")),o.addClass("um-error").attr("aria-errormessage",r),void t.hide();e.password=o.val()}wp.ajax.send("um_personal_data_export",{data:e,success:function(e){o.parents(".um-form-new").find(".um-form-submit").remove(),o.parents(".um-form-col").html('<p class="um-supporting-text">'+e+"</p>"),t.hide()},error:function(e){var r,a;e["single_user_password-export-request"]&&(r="um-error-for-single_user_password-export-request",(a=o.parents(".um-field")).find(".um-field-hint").data("hint",a.find(".um-field-hint").html()).addClass("um-field-error").attr("id",r).html(e["single_user_password-export-request"]),o.addClass("um-error").attr("aria-errormessage",r)),t.hide()}})}),jQuery(document.body).on("click","#um_account_request_erase_data",function(e){e.preventDefault();e={nonce:jQuery(this).data("nonce")};let t=jQuery(this).siblings(".um-ajax-spinner-svg"),o=(t.show(),jQuery(this).parents("form").find("#single_user_password-erase-request"));var r="um-error-for-single_user_password-erase-request",a=o.parents(".um-field");if(o.length){if(""===o.val())return a.find(".um-field-hint").data("hint",a.find(".um-field-hint").html()).addClass("um-field-error").attr("id",r).html(jQuery(this).data("error")),o.addClass("um-error").attr("aria-errormessage",r),void t.hide();e.password=o.val()}wp.ajax.send("um_personal_data_erase",{data:e,success:function(e){o.parents(".um-form-new").find(".um-form-submit").remove(),o.parents(".um-form-col").html('<p class="um-supporting-text">'+e+"</p>"),t.hide()},error:function(e){var r,a;e["single_user_password-erase-request"]&&(r="um-error-for-single_user_password-erase-request",(a=o.parents(".um-field")).find(".um-field-hint").data("hint",a.find(".um-field-hint").html()).addClass("um-field-error").attr("id",r).html(e["single_user_password-erase-request"]),o.addClass("um-error").attr("aria-errormessage",r)),t.hide()}})}),e("#um-indeterminate").prop("indeterminate",!0)}),wp.hooks.addFilter("um_uploader_data","ultimate-member",function(e,r,a){return"upload-avatar"===r&&(r=a.data("user_id"),e.url+="&user_id="+r),e}),wp.hooks.addAction("um_uploader_error","ultimate-member",function(e,r,a){e=e.find(".um-uploader-button");"upload-avatar"===e.data("handler")&&void 0!==a&&(e.parents(".um-profile-photo-uploader").removeClass("um-processing"),alert(a.message))}),wp.hooks.addAction("um_uploader_files_added","ultimate-member",function(e,r,a){e=e.find(".um-uploader-button");"upload-avatar"===e.data("handler")&&a.length&&e.parents(".um-profile-photo-uploader").addClass("um-processing")}),wp.hooks.addAction("um_uploader_upload_complete","ultimate-member",function(e,r,a){e=e.find(".um-uploader-button");"upload-avatar"===e.data("handler")&&a.length&&(jQuery.each(a,function(e){a[e]&&r.removeFile(a[e].id)}),e.parents(".um-profile-photo-uploader").removeClass("um-processing"))}),wp.hooks.addFilter("um_uploader_file_uploaded","ultimate-member",function(e,r,a,t,o){return"upload-avatar"!==r.data("handler")?e:(e={classes:"um-profile-photo-modal",duration:400,footer:"",header:wp.i18n.__("Change your profile photo","ultimate-member"),size:"normal",content:o.data[0].modal_content,source:r},UM.profile.avatarModal=UM.modal.addModal(e,null),!0)}),wp.hooks.addFilter("um_uploader_file_upload_failed","ultimate-member",function(e,r,a,t,o){return"upload-avatar"!==r.data("handler")?e:(null===o?alert(wp.i18n.__("File was not loaded. Internal server error.","ultimate-member")):o?o.info&&0===o.OK&&alert(o.info):alert(wp.i18n.__("File was not loaded. Wrong file upload server response.","ultimate-member")),!0)});