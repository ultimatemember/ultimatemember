function um_admin_init_users_select(){function e(t){var i;if(!t.id)return t.text;if(void 0!==t.img)i=jQuery('<span><img style="vertical-align: sub; width: 20px; height: 20px;" src="'+t.img+'" /> '+t.text+"</span>");else{let e;i=(e=void 0!==t.element&&void 0!==t.element.attributes["data-img"]?t.element.attributes["data-img"].value:e)?jQuery('<img style="vertical-align: sub; width: 20px; height: 20px;" src="'+e+'" /> '+t.text+"</span>"):jQuery("<span>"+t.text+"</span>")}return i}var i,n,s,a,t,r;jQuery(".um-user-select-field:visible:not(.um-select2-inited)").length&&(i="um_get_users",n="users",s=um_admin_scripts.nonce,a="",jQuery(".um-users-conditions-wrap").length&&(s=jQuery(".um-users-conditions-wrap").attr("data-nonce"),a=!0),t={ajax:{url:wp.ajax.settings.url,dataType:"json",delay:250,data:function(e){jQuery(this).attr("data-parent")&&(i="um_get_"+jQuery(this).attr("data-parent"),n=jQuery(this).attr("data-parent"));var t={action:i,search:e.term,page:e.page||1,scope:n,restrictions:a,nonce:s};return jQuery.each(jQuery(this)[0].attributes,function(){var e;this.specified&&-1!==this.name.indexOf("data-ajax-args-")&&(e=this.name.replace("data-ajax-args-","").trim(),t[e]=this.value)}),t},processResults:function(e,t){t.page=t.page||1;var i=[];return"users"===n?e.data.users&&jQuery.each(e.data.users,function(e,t){void 0!==t.img?i.push({id:t.ID,text:t.user_login+" (#"+t.ID+")",img:t.img}):i.push({id:t.ID,text:t.user_login+" (#"+t.ID+")"})}):e.data.roles&&jQuery.each(e.data.roles,function(e,t){i.push({id:e,text:t.name+" (#"+e+")"})}),{results:i,pagination:{more:20*t.page<e.data.total_count}}},cache:!0},minimumInputLength:0,allowClear:!0,width:"100%",allowHtml:!0,dropdownCssClass:"um-select2-users-dropdown",containerCssClass:"um-select2-users-container",placeholder:jQuery(this).data("placeholder"),templateSelection:e,templateResult:e},(r=jQuery(".um-user-select-field:visible:not(.um-select2-inited)")).each(function(){jQuery(this).hasClass("select2-hidden-accessible")&&jQuery(this).removeClass("um-select2-inited").select2("destroy")}),r.addClass("um-select2-inited").select2(t))}function um_admin_init_pages_select(){var t="um_get_pages_list",i="page",n=um_admin_scripts.nonce,s="";jQuery(".um-entities-conditions-wrap").length&&(n=jQuery(".um-entities-conditions-wrap").attr("data-nonce"),s=!0),jQuery(".um-pages-select2").select2({ajax:{url:wp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return jQuery(this).attr("data-parent")&&(t="page"===jQuery(this).attr("data-parent")||"post"===jQuery(this).attr("data-parent")?"um_get_pages_list":"um_get_"+jQuery(this).attr("data-parent")+"_list",i=jQuery(this).attr("data-parent")),{search:e.term,action:t,scope:i,restrictions:s,page:e.page||1,nonce:n}},processResults:function(e,t){t.page=t.page||1;var i=[];return e&&jQuery.each(e,function(e,t){"total_count"!==e&&i.push({id:t[0],text:t[1]})}),{results:i,pagination:{more:10*t.page<e.total_count}}},cache:!0},placeholder:jQuery(this).data("placeholder"),minimumInputLength:0,allowClear:!0})}function um_add_same_page_log(e,t){var e=jQuery(".um-same-page-update-"+e).find(".upgrade_log"),i=e.html();e.html(i+t+"<br />")}function um_same_page_wrong_ajax(e){um_add_same_page_log(e,wp.i18n.__("Wrong AJAX response...","ultimate-member")),um_add_same_page_log(e,wp.i18n.__("Your upgrade was crashed, please contact with support","ultimate-member"))}function um_same_page_something_wrong(e){um_add_same_page_log(e,wp.i18n.__("Something went wrong with AJAX request...","ultimate-member")),um_add_same_page_log(e,wp.i18n.__("Your upgrade was crashed, please contact with support","ultimate-member"))}jQuery(document).ready(function(){um_admin_init_users_select(),um_admin_init_pages_select(),jQuery(document.body).on("click",".um-forms-field[data-log-object]",function(){var e=jQuery(this).data("log-object");jQuery(this).is(":checked")?jQuery(this).parents("label").siblings(".um-same-page-update-"+e).show():jQuery(this).parents("label").siblings(".um-same-page-update-"+e).hide()}),jQuery(document.body).on("click",".um-admin-form-same-page-update",function(){var i,t,n,s=jQuery(this).data("upgrade_cb");jQuery(this).prop("disabled",!0),um_add_same_page_log(s,wp.i18n.__("Upgrade Process Started...","ultimate-member")),"sync_metatable"===s?(i=0,t=500,jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_usermeta_fields",nonce:um_admin_scripts.nonce},success:function(e){n=1,um_add_same_page_log(s,wp.i18n.__("Getting metadata","ultimate-member")),jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_get_metadata",nonce:um_admin_scripts.nonce},success:function(e){void 0!==e.data.count?(um_add_same_page_log(s,wp.i18n.__("There are ","ultimate-member")+e.data.count+wp.i18n.__(" metadata rows...","ultimate-member")),um_add_same_page_log(s,wp.i18n.__("Start metadata upgrading...","ultimate-member")),i=Math.ceil(e.data.count/t),function t(){n<=i?jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_update_metadata_per_page",page:n,nonce:um_admin_scripts.nonce},success:function(e){void 0!==e.data?(um_add_same_page_log(s,e.data.message),n++,t()):um_same_page_wrong_ajax(s)},error:function(){um_same_page_something_wrong(s)}}):window.location=um_forms_data.successfully_redirect}()):um_same_page_wrong_ajax(s)},error:function(){um_same_page_something_wrong(s)}})},error:function(){um_same_page_something_wrong(s)}})):wp.hooks.doAction("um_same_page_upgrade",s)}),jQuery(".um-sortable-items-field").sortable({items:".um-sortable-item",connectWith:".um-admin-drag-col,.um-admin-drag-group",forcePlaceholderSize:!0,update:function(e,t){var i=[];jQuery(this).find("li").each(function(){jQuery(this).hasClass("um-hidden-item")||i.push(jQuery(this).data("tab-id"))}),jQuery(this).siblings(".um-sortable-items-value").val(i.join(","))}}),jQuery(".um-multi-selects-list.um-sortable-multi-selects").sortable({items:".um-admin-drag-fld",connectWith:".um-admin-drag-col,.um-admin-drag-group",forcePlaceholderSize:!0}),jQuery('.um-multi-selects-list[data-field_id="_um_sorting_fields"] li').each(function(){"other"===jQuery(this).find(".um-field-wrapper:not(.um-custom-order-fields) select").val()?jQuery(this).find(".um-field-wrapper.um-custom-order-fields").show():jQuery(this).find(".um-field-wrapper.um-custom-order-fields").hide()}),jQuery('.um-forms-line[data-field_type="md_sorting_fields"] .um-multi-selects-add-option').on("click",function(){var e=jQuery(this).siblings("ul.um-multi-selects-list"),t=e.hasClass("um-sortable-multi-selects"),i=(e.data("field_id"),0),n=(0<e.find("li:last select.um-forms-field").length&&(i=+(i=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1),jQuery("<div>").append(e.siblings(".um-hidden-multi-selects").clone()).html()),s='<li class="um-multi-selects-option-line'+(t?" um-admin-drag-fld":"")+'">';t&&(s+='<span class="um-field-icon"><i class="um-faicon-sort"></i></span>');let a="";jQuery.each(um_forms_data.md_sorting_data_types,function(e,t){a+='<option value="'+e+'">'+t+"</option>"}),s+='<span class="um-field-wrapper">'+n+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+'</a></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Meta key","ultimate-member")+':&nbsp;<input type="text" name="meta_key" /></label></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Data type","ultimate-member")+':&nbsp;<select name="data_type" />'+a+'</select></label></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Order","ultimate-member")+':&nbsp;<select name="order" /><option value="ASC">'+wp.i18n.__("ASC","ultimate-member")+'</option><option value="DESC">'+wp.i18n.__("DESC","ultimate-member")+'</option></select></label></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Label","ultimate-member")+':&nbsp;<input type="text" name="label" /></label></span></li>',e.append(s),e.find("li:last .um-hidden-multi-selects").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-selects").attr("id",e.data("id_attr")+"-"+i).trigger("change"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields input[name="meta_key"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][meta_key]"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields input[name="label"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][label]"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields select[name="data_type"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][data_type]"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields select[name="order"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][order]")}),jQuery(document.body).on("change",'.um-multi-selects-list[data-field_id="_um_sorting_fields"] .um-field-wrapper:not(.um-custom-order-fields) select',function(){"other"===jQuery(this).val()?jQuery(this).parents("li").find(".um-field-wrapper.um-custom-order-fields").show():jQuery(this).parents("li").find(".um-field-wrapper.um-custom-order-fields").hide()}),jQuery(document.body).on("click",".um-multi-selects-option-line .um-select-delete",function(){jQuery(this).parents("li.um-multi-selects-option-line").remove()}),jQuery(document.body).on("click",".um-md-default-filters-option-line .um-select-delete",function(){jQuery(this).parents("li.um-md-default-filters-option-line").remove()}),jQuery(".um-multi-selects-add-option").on("click",function(){var e,t,i,n;jQuery(this).parents('.um-forms-line[data-field_type="md_sorting_fields"]').length||(t=(e=jQuery(this).siblings("ul.um-multi-selects-list")).hasClass("um-sortable-multi-selects"),e.data("field_id"),(i=0)<e.find("li:last select.um-forms-field").length&&(i=+(i=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1),n='<li class="um-multi-selects-option-line'+(t?" um-admin-drag-fld":"")+'">',t&&(n+='<span class="um-field-icon"><i class="um-faicon-sort"></i></span>'),n+='<span class="um-field-wrapper">'+jQuery("<div>").append(e.siblings(".um-hidden-multi-selects").clone()).html()+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+"</a></span></li>",e.append(n),e.find("li:last .um-hidden-multi-selects").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-selects").attr("id",e.data("id_attr")+"-"+i))}),jQuery('.um-multi-selects-add-option[data-name="um_metadata[_um_search_exclude_fields][]"]').on("click",function(){jQuery('.um-multi-selects-list[data-field_id="_um_search_include_fields"] li.um-multi-selects-option-line').remove()}),jQuery('.um-multi-selects-add-option[data-name="um_metadata[_um_search_include_fields][]"]').on("click",function(){jQuery('.um-multi-selects-list[data-field_id="_um_search_exclude_fields"] li.um-multi-selects-option-line').remove()});var i,e=-(new Date).getTimezoneOffset()/60,n=(jQuery('input[name="um-gmt-offset"]').val(e),jQuery(".um-admin-metabox").find(".um-slider").each(function(){var e=jQuery(this),t=parseInt(e.data("min")),i=parseInt(e.data("max")),t=[t=void 0!==jQuery("#"+e.data("field_name")+"_min").val()?jQuery("#"+e.data("field_name")+"_min").val():t,i=void 0!==jQuery("#"+e.data("field_name")+"_max").val()?jQuery("#"+e.data("field_name")+"_max").val():i];e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:t,create:function(e,t){},step:1,slide:function(e,t){s(jQuery(this),t)},stop:function(e,t){}}),s(e)}),jQuery(".um-admin-metabox").find(".um-datepicker-filter").each(function(){var e=jQuery(this),t=new Date(1e3*e.data("date_min")),i=new Date(1e3*e.data("date_max")),t=e.pickadate({selectYears:!0,min:t,max:i,formatSubmit:"yyyy/mm/dd",hiddenName:!0,onOpen:function(){e.blur(),e.siblings(".picker").find(".picker__button--close").addClass("button")},onClose:function(){e.blur()},onSet:function(e){}}).pickadate("picker");e.data("value")&&t.set("select",1e3*e.data("value"))}),jQuery(".um-admin-metabox").find(".um-timepicker-filter").each(function(){var e=jQuery(this),t=e.data("min"),i=e.data("max"),t=t.split(":"),i=i.split(":");e.pickatime({format:e.data("format"),interval:parseInt(e.data("intervals")),min:[t[0],t[1]],max:[i[0],i[1]],formatSubmit:"HH:i",hiddenName:!0,onOpen:function(){e.blur()},onClose:function(){e.blur()},onSet:function(e){}})}),!1);function s(e,t){var i,n="",s=e.siblings(".um-slider-range").data("placeholder-s"),a=e.siblings(".um-slider-range").data("placeholder-p"),t=t?(n=(t.values[0]===t.values[1]?s.replace("{value}",t.values[0]):a.replace("{min_range}",t.values[0]).replace("{max_range}",t.values[1])).replace("{field_label}",e.siblings(".um-slider-range").data("label")),i=t.values[0],t.values[1]):(n=(e.slider("values",0)===e.slider("values",1)?s.replace("{value}",e.slider("values",0)):a.replace("{min_range}",e.slider("values",0)).replace("{max_range}",e.slider("values",1))).replace("{field_label}",e.siblings(".um-slider-range").data("label")),i=e.slider("values",0),e.slider("values",1));e.siblings(".um-slider-range").html(n),e.siblings(".um_range_min").val(i),e.siblings(".um_range_max").val(t)}function t(){jQuery(".um-forms-line").removeClass("um-forms-line-conditioned").each(function(){void 0===jQuery(this).data("conditional")||jQuery(this).hasClass("um-forms-line-conditioned")||(!function n(e){e.addClass("um-forms-line-conditioned");var t=e.data("conditional");var i=t[1];var s=t[2];var a=e.data("prefix");var r=!0;{var o,u;"="===i||"!="===i?-1===t[0].indexOf("||")&&void 0!==(u=jQuery("#"+a+"_"+t[0])).parents(".um-forms-line").data("conditional")&&(r=n(u.parents(".um-forms-line"))):"~"===i?(l=t[0].split("|"),o=[],jQuery.each(l,function(e){o.push(jQuery("#"+a+"_"+l[e]))}),void 0!==o[0].parents(".um-forms-line").data("conditional")&&(r=n(o[0].parents(".um-forms-line")))):"><"===i&&void 0!==(u=jQuery("#"+a+"_"+t[0]+"_"+t[2])).parents(".um-forms-line").data("conditional")&&(r=n(u.parents(".um-forms-line")))}var d=!1;{var l,m,c,p,f,_,h,y;if("="===i)return-1!==t[0].indexOf("||")?(l=t[0].split("||"),m=!1,jQuery.each(l,function(e){var t,e=jQuery("#"+a+"_"+l[e]),i=(r=!(d=!1),void 0!==e.parents(".um-forms-line").data("conditional")&&(r=n(e.parents(".um-forms-line"))),e.prop("tagName").toLowerCase());"input"===i?(t=e.attr("type"),d="checkbox"===t?"1"==s?e.is(":checked"):!e.is(":checked"):Array.isArray(s)?-1!==s.indexOf(e.val()):e.val()==s):"select"===i&&(d=Array.isArray(s)?-1!==s.indexOf(e.val()):e.val()==s),d&&r&&(m=!0)}),m):("input"==(h=u.prop("tagName").toLowerCase())?(y=u.attr("type"),d="checkbox"==y?"1"==s?u.is(":checked"):!u.is(":checked"):Array.isArray(s)?-1!==s.indexOf(u.val()):u.val()==s):"select"==h&&(d=Array.isArray(s)?-1!==s.indexOf(u.val()):u.val()==s),d&&r);if("!="===i)return-1!==t[0].indexOf("||")?(l=t[0].split("||"),m=!1,jQuery.each(l,function(e){var t,e=jQuery("#"+a+"_"+l[e]),i=(r=!(d=!1),void 0!==e.parents(".um-forms-line").data("conditional")&&(r=n(e.parents(".um-forms-line"))),e.prop("tagName").toLowerCase());"input"===i?(t=e.attr("type"),d="checkbox"===t?"1"==s?!e.is(":checked"):e.is(":checked"):e.val()!=s):"select"===i&&(d=e.val()!=s),d&&r&&(m=!0)}),m):("input"==(h=u.prop("tagName").toLowerCase())?(y=u.attr("type"),d="checkbox"==y?"1"==s?!u.is(":checked"):u.is(":checked"):u.val()!=s):"select"==h&&(d=u.val()!=s),d&&r);if("~"===i)return p=[],"sortable_items"===e.data("field_type")?(c=e.find(".um-sortable-items-value").data("field_id"),jQuery.each(o,function(e){var e=o[e],t=e.prop("tagName").toLowerCase();"input"===t?"checkbox"===e.attr("type")&&"1"==s&&e.is(":checked")&&p.push(e.data("fill_"+c)):"select"==t&&!s&&e.val()&&(p=(p=p.concat(e.val())).filter(g))}),f=jQuery('[data-field_id="'+c+'"]'),p.length?(f.siblings(".um-sortable-items-field").find("li").addClass("um-hidden-item"),jQuery.each(p,function(e){f.siblings(".um-sortable-items-field").find('li[data-tab-id="'+p[e]+'"]').removeClass("um-hidden-item")}),_=[],f.siblings(".um-sortable-items-field").find("li").each(function(){jQuery(this).hasClass("um-hidden-item")||_.push(jQuery(this).data("tab-id"))}),f.val(_.join(",")),f.siblings(".um-sortable-items-field").sortable("refresh"),d=!0):f.val(null)):(c=e.find(e.data("field_type")).data("field_id"),jQuery.each(o,function(e){var e=o[e],t=e.prop("tagName").toLowerCase();"input"===t?"checkbox"===e.attr("type")&&"1"==s&&e.is(":checked")&&p.push(e.data("fill_"+c)):"select"==t&&!s&&e.val()&&(p=(p=p.concat(e.val())).filter(g))}),f=jQuery('[data-field_id="'+c+'"]'),p.length?(f.find("option").hide(),jQuery.each(p,function(e){f.find('option[value="'+p[e]+'"]').show()}),-1===p.indexOf(f.val())&&(f.val(p[0]),f.find("option").attr("selected",!1).prop("selected",!1),f.find('option[value="'+p[0]+'"]').attr("selected",!0).prop("selected",!0)),d=!0):(f.val(null),f.find("option").attr("selected",!1).prop("selected",!1))),d&&r;if("><"===i)return h=u.prop("tagName").toLowerCase(),(d="input"==h&&"checkbox"==(y=u.attr("type"))?u.is(":checked"):d)&&r}return!1}(jQuery(this))?jQuery(this).hide():(jQuery(this).show(),um_admin_init_users_select()))})}function g(e,t,i){return i.indexOf(e)===t}jQuery(document.body).on("change",".um-md-default-filters-option-line .um-field-wrapper select",function(){var i,e,t;n||(e=(i=jQuery(this)).val(),t=i.data("member_directory"),n=!0,wp.ajax.send("um_member_directory_default_filter_settings",{data:{key:e,directory_id:t,nonce:um_admin_scripts.nonce},success:function(e){var t=i.parents(".um-md-default-filters-option-line").find(".um-field-wrapper2");t.html(e.field_html),n=!1,t.find(".um-slider").each(function(){var e=jQuery(this),t=[parseInt(e.data("min")),parseInt(e.data("max"))];e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:t,create:function(e,t){},step:1,slide:function(e,t){s(jQuery(this),t)},stop:function(e,t){}}),s(e)}),t.find(".um-datepicker-filter").each(function(){var e=jQuery(this),t=new Date(1e3*e.data("date_min")),i=new Date(1e3*e.data("date_max"));e.pickadate({selectYears:!0,min:t,max:i,formatSubmit:"yyyy/mm/dd",hiddenName:!0,onOpen:function(){e.blur(),e.siblings(".picker").find(".picker__button--close").addClass("button")},onClose:function(){e.blur()},onSet:function(e){}})}),t.find(".um-timepicker-filter").each(function(){var e=jQuery(this),t=e.data("min"),i=e.data("max"),t=t.split(":"),i=i.split(":");e.pickatime({format:e.data("format"),interval:parseInt(e.data("intervals")),min:[t[0],t[1]],max:[i[0],i[1]],formatSubmit:"HH:i",hiddenName:!0,onOpen:function(){e.blur()},onClose:function(){e.blur()},onSet:function(e){}})})},error:function(e){return!1}}))}),jQuery(".um-md-default-filters-add-option").on("click",function(){var e,t,i;n||((e=jQuery(this).siblings("ul.um-md-default-filters-list")).data("field_id"),(t=0)<e.find("li:last select.um-forms-field").length&&(t=+(t=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1),i=jQuery("<div>").append(e.siblings(".um-hidden-md-default-filters").clone()).html(),e.append('<li class="um-md-default-filters-option-line"><span class="um-field-wrapper">'+i+'</span></span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+'</a></span><span class="um-field-wrapper2 um"></li>'),e.find("li:last .um-hidden-md-default-filters").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-md-default-filters").attr("id",e.data("id_attr")+"-"+t),e.find("li:last .um-field-wrapper select").trigger("change"))}),jQuery(document.body).on("click",".um-text-delete",function(){jQuery(this).parents("li.um-multi-text-option-line").remove()}),jQuery(".um-multi-text-add-option").on("click",function(){var e=jQuery(this).siblings("ul.um-multi-text-list"),t=0,i=(0<e.find("li:last input.um-forms-field").length&&(t=+(t=e.find("li:last input.um-forms-field").attr("id").split("-"))[1]+1),jQuery("<div>").append(e.siblings(".um-hidden-multi-text").clone()).html()),n=e.data("item_class");e.append('<li class="'+n+'"><span class="um-field-wrapper">'+i+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-text-delete">'+wp.i18n.__("Remove","ultimate-member")+"</a></span></li>"),e.find("li:last .um-hidden-multi-text").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-text").attr("id",e.data("id_attr")+"-"+t)}),jQuery(".um-media-upload").each(function(){var e=jQuery(this).find(".um-forms-field"),t=e.data("default");""!=e.val()&&e.val()!=t?(e.siblings(".um-set-image").hide(),e.siblings(".um-clear-image").show(),e.siblings(".icon_preview").show()):(e.val()==t&&e.siblings(".icon_preview").show(),e.siblings(".um-set-image").show(),e.siblings(".um-clear-image").hide())}),"undefined"!=typeof wp&&wp.media&&wp.media.editor&&(jQuery(".um-set-image").on("click",function(e){var t=jQuery(this);e.preventDefault(),i&&i.remove(),(i=wp.media({title:t.data("upload_frame"),button:{text:wp.i18n.__("Select","ultimate-member")},multiple:!1})).on("select",function(){var e=i.state().get("selection").first().toJSON();t.siblings(".icon_preview").attr("src",e.url).show(),t.siblings(".um-forms-field").val(e.url),t.siblings(".um-media-upload-data-id").val(e.id),t.siblings(".um-media-upload-data-width").val(e.width),t.siblings(".um-media-upload-data-height").val(e.height),t.siblings(".um-media-upload-data-thumbnail").val(e.thumbnail),t.siblings(".um-media-upload-data-url").trigger("change"),t.siblings(".um-media-upload-url").val(e.url),t.siblings(".um-clear-image").show(),t.hide(),jQuery(document).trigger("um_media_upload_select",[t,e])}),i.open()}),jQuery(".icon_preview").on("click",function(e){jQuery(this).siblings(".um-set-image").trigger("click")}),jQuery(".um-clear-image").on("click",function(e){var t=jQuery(this);let i=t.siblings(".um-forms-field").data("default");void 0===i&&(i=""),t.siblings(".um-set-image").show(),t.hide(),t.siblings(".icon_preview").attr("src",i),""===i&&t.siblings(".icon_preview").hide(),t.siblings(".um-media-upload-data-id").val(""),t.siblings(".um-media-upload-data-width").val(""),t.siblings(".um-media-upload-data-height").val(""),t.siblings(".um-media-upload-data-thumbnail").val(""),t.siblings(".um-forms-field").val(i),t.siblings(".um-media-upload-data-url").trigger("change"),t.siblings(".um-media-upload-url").val(i),jQuery(document).trigger("um_media_upload_clear",t)})),jQuery(document.body).on("change",".um-forms-field",function(){(0<jQuery(".um-forms-line[data-conditional*='\""+jQuery(this).data("field_id")+"\",']").length||0<jQuery(".um-forms-line[data-conditional*='"+jQuery(this).data("field_id")+"|']").length||0<jQuery(".um-forms-line[data-conditional*='|"+jQuery(this).data("field_id")+"']").length)&&t()}),t(),jQuery(".um-entities-conditions-wrap").on("change",".um-entities-conditions",function(){var e=jQuery(this).closest(".um-entities-conditions-row"),t=jQuery(this).find(":selected").val(),i=e.find(".um-entities-conditions").data("original");e.find(".um-entities-conditions-responce").attr("data-parent",t),console.log(e.find(".um-entities-conditions-responce")),e.find(".um-entities-conditions-responce").hasClass("um-pages-select2")&&(e.find(".um-entities-conditions-responce").select2("destroy"),e.find(".um-entities-conditions-responce").html(""),e.find(".um-entities-conditions-responce").removeClass("um-pages-select2").removeClass("select2-hidden-accessible")),"none"===t?(e.find("select, input").removeAttr("name"),e.find(".um-entities-conditions-responce").removeAttr("disabled").removeAttr("multiple"),e.find(".um-entities-conditions-responce").html(""),e.find(".um-entities-conditions-responce").addClass("um-entities-conditions-responce-hide"),e.find(".um-entities-conditions").addClass("um-entities-conditions-full"),e.find(".um-entities-conditions-responce-input").remove()):"site"===t?(e.find(".um-entities-conditions-responce").html(""),e.find(".um-entities-conditions-responce").removeAttr("multiple"),e.find(".um-entities-conditions-responce").attr("disabled","disabled"),e.find(".um-entities-conditions-responce").addClass("um-entities-conditions-responce-hide"),e.find(".um-entities-conditions").addClass("um-entities-conditions-full"),e.find(".um-entities-conditions-responce").after('<input type="hidden" class="um-entities-conditions-responce-input" name="'+i+'[site]" value="1">')):(e.find(".um-entities-conditions-responce").addClass("um-pages-select2"),e.find(".um-entities-conditions-responce").removeAttr("disabled"),e.find(".um-entities-conditions-responce").removeClass("um-entities-conditions-responce-hide"),e.find(".um-entities-conditions").removeClass("um-entities-conditions-full"),e.find(".um-entities-conditions-responce").attr("multiple","multiple"),e.find(".um-entities-conditions").attr("name",i+"["+t+"]"),e.find(".um-entities-conditions-responce").attr("name",i+"["+t+"][]"),e.find(".um-entities-conditions-responce-input").remove(),um_admin_init_pages_select())}),jQuery("#um_add_protection_rule").on("click",function(e){e.preventDefault();var e=jQuery(this).closest(".um-restriction-rule-content").find(".um-protection-include-wrap"),t=jQuery(".um-entities-conditions-row-hidden .um-entities-conditions-row:first").clone();e.append(t),e.find(".um-entities-conditions-row:last").find("select").removeAttr("disabled"),e.find(".remove-row").removeAttr("disabled")}),jQuery("#um_add_exclusion_rule").on("click",function(e){e.preventDefault();var e=jQuery(this).closest(".um-restriction-rule-content").find(".um-protection-exclude-wrap"),t=(jQuery(this).closest(".um-restriction-rule-content").find(".um-protection-include-wrap"),jQuery(".um-entities-conditions-row-hidden .um-entities-conditions-row:first").clone());jQuery(this).closest(".um-restriction-rule-content").find(".um-forms-line").show(),t.find(".um-entities-conditions").attr("data-original","um_restriction_rule_content[_um_exclude]"),t.find(".um-entities-conditions").attr("data-field_id","_um_exclude"),t.find(".um-entities-conditions").removeClass("um-protection-include").addClass("um-protection-exclude"),t.find(".um-entities-conditions-responce").attr("data-original","um_restriction_rule_content[_um_include]"),t.find(".um-entities-conditions-responce").attr("data-field_id","_um_exclude"),t.find(".um-entities-conditions-responce").removeClass("um-protection-include").addClass("um-protection-exclude"),t.find('.um-entities-conditions-responce option[value!="0"], input').remove(),t.find(".um-entities-conditions-responce option").html(""),t.find(".um-entities-conditions option").removeAttr("selected"),t.find(".um-entities-conditions, .um-entities-conditions-responce").removeAttr("name"),t.find(".um-entities-conditions-responce").removeAttr("multiple"),t.find(".um-entities-conditions").addClass("um-entities-conditions-full"),t.find(".um-entities-conditions-responce").addClass("um-entities-conditions-responce-hide"),e.append(t),e.find(".um-entities-conditions-row:last").find("select").removeAttr("disabled"),e.find(".remove-row").removeAttr("disabled")}),jQuery(".um-entities-conditions-wrap").on("click",".remove-row",function(e){e.preventDefault();var e=jQuery(this).closest(".um-entities-conditions-wrap"),t=jQuery(this).closest(".um-entities-conditions-row");1<e.find(".um-entities-conditions-row").length?t.remove():(e.find("select").removeAttr("disabled").removeAttr("multiple"),e.find("select option").removeAttr("selected"),e.find(".um-entities-conditions-responce").html(""),e.find("input").remove(),1===jQuery(this).closest(".um-protection-include-wrap").length&&(jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").hide(),jQuery("#um_add_exclusion_rule").attr("disabled","disabled"),jQuery(".um-protection-exclude-wrap .um-entities-conditions-row").remove(),jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions").addClass("um-entities-conditions-full"),jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions-responce").hasClass("um-pages-select2")&&(jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions-responce").select2("destroy"),jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions-responce").removeClass("um-pages-select2")),jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions-responce").addClass("um-entities-conditions-responce-hide"),jQuery(this).closest(".um-protection-include-wrap").find(".um-pages-select2").length)&&jQuery(this).closest(".um-protection-include-wrap").find(".um-pages-select2").select2("destroy"),1===jQuery(this).closest(".um-protection-exclude-wrap").length&&(jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").hide(),jQuery(".um-protection-exclude-wrap .um-entities-conditions-row").remove(),jQuery(this).closest(".um-protection-exclude-wrap").find(".um-pages-select2").length)&&jQuery(this).closest(".um-protection-exclude-wrap").find(".um-pages-select2").select2("destroy"))}),jQuery(".um-protection-include-wrap .um-entities-conditions-row").length&&(null===jQuery(".um-protection-include-wrap .um-entities-conditions-row .um-entities-conditions-responce").val()?"site"!==jQuery(".um-protection-include-wrap .um-entities-conditions-row .um-entities-conditions-responce-input").val()&&jQuery("#um_add_exclusion_rule").attr("disabled","disabled"):jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").show(),void 0===jQuery(".um-protection-exclude-wrap .um-entities-conditions-row .um-entities-conditions-responce").val())&&jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").hide(),jQuery(document).on("change",".um-protection-include-wrap .um-entities-conditions-responce",function(){var t=!0;jQuery(".um-protection-include-wrap .um-entities-conditions-responce").each(function(){var e=jQuery(this).val();null===e&&(e=1),Array.isArray(e)?0!==e.length&&(t=!1):0!==parseInt(e)&&null!==e&&(t=!1)}),!1===t?jQuery("#um_add_exclusion_rule").removeAttr("disabled","disabled"):(jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").hide(),jQuery("#um_add_exclusion_rule").attr("disabled","disabled"),jQuery(".um-protection-exclude-wrap .um-entities-conditions-row").remove())}),jQuery(document).on("change",".um-protection-include-wrap .um-entities-conditions",function(){var e=!1;"site"===jQuery(this).val()?e=!0:jQuery(this).closest(".um-protection-include-wrap").find(".um-entities-conditions-responce").each(function(){0!==parseInt(jQuery(this).val())&&(e=!0)}),!0===e?jQuery("#um_add_exclusion_rule").removeAttr("disabled","disabled"):(jQuery(".um-protection-exclude-wrap").closest(".um-forms-line").hide(),jQuery("#um_add_exclusion_rule").attr("disabled","disabled"),jQuery(".um-protection-exclude-wrap .um-entities-conditions-row").remove())}),jQuery(".um-users-conditions-wrap").on("change",".um-users-conditions",function(){var e=jQuery(this).closest(".um-users-conditions-row"),t=jQuery(this).find(":selected").val(),i=jQuery(this).closest(".um-users-conditions-row-group").attr("data-group"),n=e.find(".um-users-conditions").data("original");e.find(".um-users-conditions-responce").attr("data-parent",t),e.find(".um-users-conditions-responce").hasClass("um-select2-inited")&&(e.find(".um-users-conditions-responce").select2("destroy"),e.find(".um-users-conditions-responce").html(""),e.find(".um-users-conditions-responce").removeClass("um-select2-inited").removeClass("select2-hidden-accessible")),"none"===t?(e.find("select").removeAttr("name"),e.find(".um-users-conditions-responce").removeAttr("multiple"),e.find(".um-users-conditions-responce").html("")):(jQuery(".um-users-conditions-responce").addClass("um-user-select-field"),e.find(".um-users-conditions-responce").attr("multiple","multiple"),e.find(".um-users-conditions").attr("name",n+"["+parseInt(i)+"]["+t+"]"),e.find(".um-users-conditions-compare").attr("name",n+"["+parseInt(i)+"]["+t+"][compare]"),e.find(".um-users-conditions-responce").attr("name",n+"["+parseInt(i)+"]["+t+"][ids][]"),um_admin_init_users_select())}),jQuery(".um-users-conditions-wrap").on("click",".add-row",function(e){e.preventDefault();var e=jQuery(this).closest(".um-users-conditions-row-group"),t=jQuery(".um-users-conditions-row-hidden .um-users-conditions-row").clone();t.find('.um-users-conditions-responce option[value!="0"]').remove(),t.find(".um-users-conditions-responce option").html(""),t.find(".um-users-conditions option").removeAttr("selected"),t.find(".um-users-conditions, .um-users-conditions-compare, .um-users-conditions-responce").removeAttr("name"),t.find(".um-users-conditions-responce").removeAttr("multiple"),t.find(".um-users-conditions-compare option:first").prop("selected",!0),e.append(t),e.find(".remove-row").removeAttr("disabled")}),jQuery(".um-users-conditions-wrap").on("click",".remove-row",function(e){e.preventDefault();var e=jQuery(this).closest(".um-users-conditions-wrap"),t=jQuery(this).closest(".um-users-conditions-row");1<e.find(".um-users-conditions-row").length?t.remove():(t.find(".um-users-conditions option, .um-entities-conditions-responce option").removeAttr("selected"),e.find(".um-users-conditions-row").find("select").removeAttr("disabled").removeAttr("multiple"),e.find('.um-users-conditions-responce option[value!="0"]').remove(),e.find(".um-users-conditions-responce option").html("")),1<e.find(".um-users-conditions-row").length&&t.remove(),jQuery(".um-users-conditions-row-group").each(function(){var e;0===jQuery(this).find(".um-users-conditions-row").length&&(e=jQuery(this).nextAll(".um-users-conditions-row-group"),jQuery(this).remove(),e)&&e.each(function(){var e=jQuery(this).attr("data-group"),t=jQuery(this).find(".um-users-conditions").attr("name"),i=jQuery(this).find(".um-users-conditions-compare").attr("name"),n=jQuery(this).find(".um-users-conditions-responce").attr("name"),s=parseInt(e)-1;jQuery(this).attr("data-group",s),t&&(t=t.replace(e,s),jQuery(this).find(".um-users-conditions").attr("name",t)),i&&(t=i.replace(e,s),jQuery(this).find(".um-users-conditions-compare").attr("name",t)),n&&(i=n.replace(e,s),jQuery(this).find(".um-users-conditions-responce").attr("name",i))})})}),jQuery(".um-users-conditions-wrap").on("click",".add-group-row",function(e){e.preventDefault();var e=jQuery(this).closest(".um-users-conditions-wrap"),t=jQuery(".um-users-conditions-row-hidden .um-users-conditions-row-group").clone(),i=jQuery(".um-users-conditions-row-group:last").attr("data-group");t.find(".um-users-conditions-row").not(":first").remove(),t.find('.um-users-conditions-responce option[value!="0"]').remove(),t.find(".um-users-conditions-responce option").html(""),t.find(".um-users-conditions option").removeAttr("selected"),t.find(".um-users-conditions,.um-users-conditions-compare , .um-users-conditions-responce").removeAttr("name"),t.find(".um-users-conditions-responce").removeAttr("multiple"),t.find(".um-users-conditions-compare option:first").prop("selected",!0),t.attr("data-group",parseInt(i)+1),t.find(".um-users-conditions-responce").addClass("um-user-select-field"),jQuery(this).closest(".um-conditions-group-action-wrap").before(t),e.find(".um-conditions-row-action").removeAttr("disabled")}),jQuery("#um-restriction-rules #the-list").sortable({update:function(e,t){var i={},n=jQuery("#um_restriction_rules_nonce").val();jQuery("#um-restriction-rules #the-list tr").each(function(e){var t=jQuery(this).find(".check-column input").val();i[t]=e}),jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_restriction_rules_order",_wpnonce:n,indexes:i},success:function(e){},error:function(e){console.log(e)}})}})});